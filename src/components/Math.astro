---
import katex from 'katex';
import {NOTATION} from '../consts';
import {unified} from 'unified';
import remarkParse from 'remark-parse';
import remarkMath from 'remark-math';
import remarkRehype from 'remark-rehype';
import rehypeKatex from 'rehype-katex';
import rehypeStringify from 'rehype-stringify';

export interface Props {
    formula: string,
    description: string
}

const {
    formula, 
    description="Please insert the description of this equation"
} = Astro.props;

const html = katex.renderToString(formula, {
    macros: NOTATION
});

let caption = unified()
    .use(remarkParse)
    .use(remarkMath)
    .use(remarkRehype)
    .use(rehypeKatex, {
        macros: NOTATION
    })
    .use(rehypeStringify)
    .process(description)

---

<div data-latex={formula} id="math" class="math relative flex flex-col items-center border-[0.3px] border-dark-100 my-4">
    <p set:html={html} class="pt-4"></p>
    <div set:html={caption} class="py-4"></div>
    <!-- The button is disable because most of the latex are custom commands -->
    <button id="test-latex" class="hidden absolute top-2 right-2">Copy LaTeX</button>
</div>

<script>
const btn = document.querySelector("#test-latex");
const math = document.querySelector("#math");

btn.addEventListener('click', () => {
    navigator.clipboard.writeText(math.dataset.latex);
    console.log(math.dataset.latex);
});
</script>
