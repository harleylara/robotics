---
import fs from 'node:fs/promises';
import { XMLParser } from 'fast-xml-parser';

const {
    file,
    page="1",
    description
} = Astro.props;

const url = new URL(`../resources/${file}`, import.meta.url);
const xmlFile = await fs.readFile(url, 'utf-8');

const parser = new XMLParser();
// console.log(parser.parse(xmlFile));
const diagram = parser.parse(xmlFile).mxfile.diagram[parseInt(page)-1];
console.log(diagram);

const src = `https://viewer.diagrams.net/?tags=%7B%7D&highlight=0000ff&edit=_blank&layers=1&nav=1&title=test.drawio#R${encodeURIComponent(diagram)}`
console.log("ENCODED diagram:" + encodeURIComponent(diagram));
console.log("FULL URL: " + src);

/* 
Just for documentation
drawio diagram viewer: https://github.com/jgraph/drawio-tools/blob/master/tools/viewer.html
*/
---
<div class="flex flex-col items-center border-[0.3px] border-dark-100 my-4 w-full">
    <iframe style="width:100%;height:380px;" src={src}></iframe>
    <em class="py-4">Figure X.X: {description}</em>
</div>
